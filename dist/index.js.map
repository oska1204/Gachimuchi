{"version":3,"sources":["webpack://myapp/./src/index.js"],"names":["urls","Array","from","document","querySelectorAll","v","querySelector","a","vp","addEventListener","syncVideo","currentTime","playbackRate","enrollPause","setTimeout","undefined","clearTimeout","cancel","pause","play","volume","c","queue","links","videos","index","randomVideoUrl","rnd","Math","floor","random","length","indexOf","text","nextVideo","reqUrl","hidden","queueUrl","item","shift","rndUrl","checked","url","current","navigator","mediaSession","metadata","MediaMetadata","title","textContent","replace","innerHTML","outerHTML","parentNode","console","log","children","map","e","i","firstElementChild","href","join","match","old","parentElement","getAttribute","error","fetch","method","response","json","push","audios","filter","elm","load","sourceElms","srcs","forEach","src","source","createElement","append","poster","thumbnail","setActionHandler","func","time","openSupinic","preventDefault","open","target","altKey","body","style","display","ti","compensate","paused","visibilityState","classList","add","controls","remove"],"mappings":"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","file":"index.js","sourcesContent":["const sndcld = url => `<iframe width=\"100%\" height=\"166\" scrolling=\"no\" frameborder=\"no\" allow=\"autoplay\"\r\n\tsrc=\"https://w.soundcloud.com/player/?url=${url}&auto_play=true\"></iframe>`\r\nconst ytbe = url => `<iframe src=\"https://www.youtube.com/embed/${url.slice(url.lastIndexOf('/') + 1)}?autoplay=1\"></iframe>`\r\nconst blbl = url => `<iframe src=\"https://player.bilibili.com/player.html?aid=${url.slice(url.lastIndexOf('av') + 2)}&autoplay=1\"></iframe>`\r\n\r\n\r\nconst urls = Array.from(document.querySelectorAll('[field=\"Name\"] a'))\r\nlet v = document.querySelector('#video')\r\nlet a = document.querySelector('#audio')\r\nconst vp = document.querySelector('.video-player')\r\nv.addEventListener('play', () => {\r\n    syncVideo()\r\n})\r\nv.addEventListener('timeupdate', () => {\r\n    if (v.currentTime > a.currentTime + 2 || v.currentTime < a.currentTime - 3)\r\n        syncVideo()\r\n    else if (v.currentTime > a.currentTime + .2)\r\n        v.playbackRate = .9\r\n    else if (v.currentTime < a.currentTime - .2)\r\n        v.playbackRate = 1.1\r\n    else\r\n        v.playbackRate = 1\r\n})\r\na.addEventListener('ended', () => enrollPause())\r\na.addEventListener('suspended', () => enrollPause())\r\na.addEventListener('waiting', () => setTimeout(() => enrollPause(undefined, 9000), 1000))\r\na.addEventListener('error', () => setTimeout(() => enrollPause(undefined, 9000), 1000))\r\na.addEventListener('timeupdate', () => clearTimeout(cancel))\r\na.addEventListener('pause', () => {\r\n    syncVideo()\r\n    v.pause()\r\n})\r\na.addEventListener('play', () => {\r\n    syncVideo()\r\n    v.play()\r\n})\r\na.volume = .4\r\nconst c = document.querySelector('[type=\"checkbox\"]')\r\nconst queue = []\r\nlet links = []\r\nlet videos = []\r\nlet past = 0\r\nlet index = 0\r\nlet currentSong = 0\r\nindex = urls.indexOf(randomVideoUrl())\r\nfunction randomVideo() {\r\n    nextVideo(randomVideoUrl())\r\n}\r\nfunction randomVideoUrl() {\r\n    const rnd = Math.floor(Math.random() * urls.length)\r\n    // const time = parseInt(Date.now() / 1000)\r\n    // const rnd = parseInt(time.toString() + index) % urls.length\r\n    // console.log(time, new Date(time * 1000), time.toString() + index, index, rnd, urls[rnd])\r\n    return urls[rnd]\r\n}\r\nconst text = document.querySelector('.text')\r\nasync function nextVideo(reqUrl = '') {\r\n    vp.hidden = false\r\n    links = []\r\n    videos = []\r\n    a.pause()\r\n    v.pause()\r\n    let queueUrl = false\r\n    let rndUrl\r\n    clearTimeout(cancel)\r\n    if (!reqUrl) {\r\n        const item = queue.shift()\r\n        reqUrl = item\r\n        if (item)\r\n            queueUrl = true\r\n        else\r\n            rndUrl = c.checked ? randomVideoUrl() : urls[++index] || urls[0]\r\n    }\r\n    let url = (reqUrl || rndUrl)\r\n    if (!queueUrl)\r\n        index = urls.indexOf(url)\r\n    currentSong = urls.indexOf(url)\r\n    text.current = url\r\n    try {\r\n        navigator.mediaSession.metadata = new MediaMetadata({ title: url.textContent.replace(/(\\n|\\t)+/g, ' ') })\r\n    } catch { }\r\n    text.innerHTML = `\r\n        <p>Name: ${url.outerHTML}</p>\r\n        <p>Published ${url.parentNode.parentNode.querySelector('[field=\"Published\"]').innerHTML}</p>\r\n        <p>Author: ${url.parentNode.parentNode.querySelector('[field=\"Author\"]').innerHTML}</p>\r\n        <p>ID: ${url.parentNode.parentNode.querySelector('[field=\"ID\"]').innerHTML}</p>`\r\n    console.log(Array.from(document.querySelector('.text').children).map((e, i) => i ? e.textContent : e.textContent.replace(/\\n/, ' ').replace(/\\t*/g, '') + '\t' + e.firstElementChild.href).join('\\n'))\r\n    let old\r\n    if (!url.href.match(/https?:\\/\\/(.*?\\.)?youtu(\\.be|be\\.com)\\//)) {\r\n        old = url.href\r\n        try {\r\n            url = 'supinic.com' + url.parentElement.parentElement.querySelector('[field=\"ðŸ”\"]').firstElementChild.getAttribute('href') || url.href\r\n        } catch (error) {\r\n        }\r\n    }\r\n    else\r\n        url = url.href\r\n    if (!url) {\r\n        url = old\r\n        old = null\r\n    }\r\n    clearTimeout(cancel)\r\n    let response = await fetch('?url=' + url, { method: 'post' })\r\n    let json = await response.json()\r\n    clearTimeout(cancel)\r\n    if (json === 'old' && old) {\r\n        response = await fetch('?url=' + old, { method: 'post' })\r\n        json = await response.json()\r\n    }\r\n    try {\r\n        links.push(...json.audios)\r\n    } catch (error) {\r\n    }\r\n    try {\r\n        videos.push(...json.videos)\r\n    } catch (error) {\r\n    }\r\n    videos = videos.filter(e => e)\r\n    links = links.filter(e => e)\r\n    const pause = (elm) => {\r\n        elm.pause()\r\n        elm.innerHTML = ''\r\n        elm.load()\r\n    }\r\n    pause(a)\r\n    pause(v)\r\n    const sourceElms = (elm, srcs) => {\r\n        srcs.forEach(src => {\r\n            const source = document.createElement('source')\r\n            source.src = src\r\n            elm.append(source)\r\n        })\r\n    }\r\n    sourceElms(a, links)\r\n    sourceElms(v, videos)\r\n    a.poster = json.thumbnail\r\n    a.load()\r\n    v.load()\r\n    a.play()\r\n}\r\nconst prevVideo = function () {\r\n    index === 0\r\n        ? index = urls.length - 1\r\n        : index--\r\n    nextVideo(urls[index])\r\n}\r\ntry {\r\n    navigator.mediaSession.setActionHandler('nexttrack', () => nextVideo());\r\n    navigator.mediaSession.setActionHandler('previoustrack', () => prevVideo());\r\n} catch { }\r\n// a.addEventListener('error', () => {\r\n// \tenrollPause(() => {\r\n// \t\tif (links.length > 0)\r\n// \t\t\ta.src = links.shift()\r\n// \t\telse\r\n// \t\t\tenrollPause()\r\n// \t}, 500)\r\n// })\r\n// let cancelVideo\r\n// const checkVideo = () => {\r\n// \tif (videos.length > 0) {\r\n// \t\tv.src = videos.shift()\r\n// \t\tv.play()\r\n// \t}\r\n// }\r\n// v.addEventListener('error', () => {\r\n// \tclearTimeout(cancelVideo)\r\n// \tcancelVideo = setTimeout(checkVideo, 500)\r\n// })\r\n// v.addEventListener('pause', () => {\r\n// \tclearTimeout(cancelVideo)\r\n// \tif (!a.paused)\r\n// \t\tcancelVideo = setTimeout(checkVideo, 500)\r\n// })\r\n// v.addEventListener('timeupdate', () => clearTimeout(cancelVideo))\r\ndocument.addEventListener('click', e => {\r\n    const openSupinic = (elm) => {\r\n        const href = elm.getAttribute('href') || ''\r\n        if (href.match(/^\\/track\\//)) {\r\n            e.preventDefault()\r\n            open('https://supinic.com' + href)\r\n        }\r\n    }\r\n    openSupinic(e.target)\r\n    openSupinic(e.target.parentElement)\r\n    try {\r\n        if (e.target.parentElement.getAttribute('field') === 'Name') {\r\n            e.preventDefault()\r\n            if (!e.altKey)\r\n                nextVideo(e.target)\r\n            else\r\n                queue.push(e.target)\r\n        }\r\n    } catch (error) {\r\n\r\n    }\r\n})\r\ndocument.body.style.display = ''\r\nlet cancel\r\nfunction enrollPause(func = nextVideo, time = 1000) {\r\n    clearTimeout(cancel)\r\n    cancel = setTimeout(() => {\r\n        func()\r\n    }, time)\r\n}\r\nlet compensate = 0\r\nconst syncVideo = () => {\r\n    v.currentTime = a.currentTime + compensate\r\n    setTimeout(() => {\r\n        compensate += a.currentTime - v.currentTime\r\n        v.currentTime = a.currentTime + compensate\r\n    }, 1000)\r\n}\r\ndocument.addEventListener('visibilitychange', () => {\r\n    a.paused ? v.pause() : v.play()\r\n    if (document.visibilityState === 'visible')\r\n        syncVideo()\r\n})\r\nlet ti\r\nvp.addEventListener('mousemove', (e) => {\r\n    const elm = e.target\r\n    clearTimeout(ti)\r\n    a.classList.add('cursor')\r\n    a.controls = true\r\n    ti = setTimeout(() => {\r\n        a.classList.remove('cursor')\r\n        a.controls = false\r\n    }, 1000)\r\n})\r\nvp.addEventListener('mouseleave', () => {\r\n    a.controls = false\r\n})\r\na.addEventListener('input', () => clearTimeout(ti))\r\nv.addEventListener('input', () => clearTimeout(ti))"],"sourceRoot":""}